<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.0, user-scalable=no"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
<link rel="shortcut icon" href="//s1.music.126.net/style/favicon.ico?v20180823" />
<title>网易云任务</title>
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/mdui@1.0.1/dist/css/mdui.min.css"
  integrity="sha384-cLRrMq39HOZdvE0j6yBojO4+1PrHfB7a9l5qLcmRm/fiWXYY+CndJPmyu5FV/9Tw"
  crossorigin="anonymous"
/>
<script
  src="https://cdn.jsdelivr.net/npm/mdui@1.0.1/dist/js/mdui.min.js"
  integrity="sha384-gCMZcshYKOGRX9r6wbDrvF+TcCCswSHFucUzUPwka+Gr+uHgjlYvkABr95TCOz3A"
  crossorigin="anonymous"
></script>
<#assign ctx=req.getContextPath()>
</head>
<body>
	<div class="mdui-container">
		<div class="mdui-row">
		    <div class="mdui-col-md-6 mdui-col-offset-md-3">
				<div class="mdui-card mdui-m-t-5">
					<div class="mdui-text-center">
						<h4 class="mdui-text-center">使用<a href="https://music.163.com/download">网易云音乐APP</a>扫描二维码登录</h4>
						<input type="hidden" id="sid" value="${sid}">
						<img src="${qrimg}" />
						<button class="mdui-btn mdui-color-indigo mdui-ripple mdui-text-center mdui-center">点击刷新</button>
					</div>
					<span class="mdui-text-center mdui-center" style="margin-top: 20px">
						<a href="javascript:;" class="mdui-ripple mdui-text-color-theme" style="margin-right: 15px">
					    <i class="mdui-icon material-icons">&#xe190;</i>
					    <label>安全</label>
					 	</a>
						<a href="javascript:;" class="mdui-ripple mdui-text-color-theme" style="margin-right: 15px">
					    <i class="mdui-icon material-icons">&#xe3e7;</i>
					    <label>高效</label>
					 	</a>
						<a href="javascript:;" class="mdui-ripple mdui-text-color-theme">
					   	<i class="mdui-icon material-icons">&#xe0d2;</i>
					    <label>便捷</label>
					 	</a>
					</span>
				</div>
		    </div>
		 </div>
	</div>
	<script type="text/javascript">
	var $ = mdui.$;
	initWebsocket();
	function initWebsocket(){
		if(typeof(WebSocket) == "undefined") {  
			console.error("您的浏览器不支持WebSocket");  
		}else{  
			socket = new WebSocket("ws://"+window.location.host+"/websocket/"+$("#sid").val()); 
			socket.onopen = function() {  
			};  
			socket.onmessage = function(msg) {
				console.log(msg);
				var d = eval('(' + msg.data + ')');
				if(d.code == 803){
					location.href = "${ctx}/task/"+d.userId;
				}
			};  
			socket.onclose = function() {  
				console.log("Socket已关闭");  
			};  
			socket.onerror = function() {  
				alert("Socket发生了错误");  
			};
		}
	}
	</script>
</body>
</html>